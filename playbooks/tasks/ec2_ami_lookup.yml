---
- name: Find AKI ID for parent image.
  shell: 'aws ec2 describe-images --region {{ ansible_ec2_placement_region }} --image-ids {{ ami_parent }} --output text | grep ^IMAGES'
  register: aki

- name: Saving AKI ID as a fact for later use
  set_fact:
    ami_aki_id: '{{ item.split("\t")[7] }}'
  with_items: aki.stdout

- name: Checking validity of AKI ID
  fail: msg="Did not get AKI id, ensure a PVM AMI is supplied for resnap operations"
  when: not (ami_aki_id | match("aki-.*"))

- name: Find EBS Snapshot ID for parent image.
  shell: 'aws ec2 describe-images --region {{ ansible_ec2_placement_region }} --image-ids {{ ami_parent }} --output text | grep ^EBS'
  register: ebsparent

- name: Saving ebs_parent_id as a fact for later use
  set_fact:
    ebs_parent_id: '{{ item.split("\t")[3] }}'
  with_items: ebsparent.stdout

